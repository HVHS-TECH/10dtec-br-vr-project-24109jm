<!DOCTYPE html>
<html>
  <head>
    <title>DiceRoll VR</title>
    <link rel="icon" type="image/png" href="./Favicon.png">
    <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
    <script src="https://rawgit.com/donmccurdy/aframe-extras/v2.1.1/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v3.3.0/dist/aframe-physics-system.min.js"></script>
    <script src="https://recast-api.donmccurdy.com/aframe-inspector-plugin-recast.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://rawgit.com/donmccurdy/aframe-extras/v2.1.1/dist/aframe-extras.loaders.min.js"></script>
  </head>
  <body>    
    <a-scene physics="gravity: -9.8; restitution: 0.1" inspector-plugin-recast>
      <a-entity 
        camera 
        position="0 1.6 0" 
        wasd-controls="enabled: false" 
        look-controls="enabled: true">
        <a-entity id="cursor" cursor="rayOrigin: mouse" raycaster="objects: .clickable"></a-entity>
      </a-entity>
      <a-sky color="lightblue"></a-sky>
      <a-entity id="player" dynamic-body></a-entity>
    
      <a-entity 
        ply-model="src:WoodRoom.ply"
        scale="1 1 1"
        position="2 -2 -2"
        rotation="270 90 0"
        static-body>
      </a-entity>
    
      <a-entity 
        ply-model="src:Table.ply"
        scale="0.5 0.5 0.5"
        position="1.5 -0.8 -0.7"
        rotation="270 90 0"
        static-body>
      </a-entity>
    
      <a-entity 
        id="diceCup"
        class="clickable"
        ply-model="src:DiceCup.ply"
        scale="0.05 0.05 0.05"
        position="0.7 1.1 -0.8"
        rotation="270 45 0"
        static-body
        dice-cup-listener>
      </a-entity>

      <a-entity 
        id="dice"
        ply-model="src:Dice.ply"
        scale="0.05 0.05 0.05"
        position="0.7 1.1 -0.75"
        rotation="270 45 0"
        static-body
        dice-listener>
      </a-entity>
    </a-scene>

    <script>
      AFRAME.registerComponent('dice-cup-listener', {
        init: function () {
          window.addEventListener('diceCupClicked', () => {
            console.log('diceCup received the broadcast');
          });
        }
      });

      AFRAME.registerComponent('dice-listener', {
        init: function () {
          window.addEventListener('diceCupClicked', () => {
            console.log('dice received the broadcast');
          });
        }
      });

      document.addEventListener('DOMContentLoaded', function() {
        var cursorEl = document.getElementById('cursor');
        cursorEl.addEventListener('click', function(evt) {
          var clickedEl = evt.detail.intersectedEl;
          if (clickedEl && clickedEl.id === 'diceCup') {
            var event = new Event('diceCupClicked');
            window.dispatchEvent(event);
          }
        });
      });
    </script>
  </body>
</html>
